const f={invoice:"https://n8n.srv1009033.hstgr.cloud/webhook/invoice",ga:"https://n8n.srv1009033.hstgr.cloud/webhook/GA",kdr:"https://n8n.srv1009033.hstgr.cloud/webhook/KDR"};async function x(s,o){const i="/api/send",l=f[s];try{const c=new AbortController,h=setTimeout(()=>c.abort(),15e3),e=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(o),signal:c.signal,mode:"cors"});if(clearTimeout(h),!e.ok){const r=await e.text().catch(()=>"Service unavailable");console.warn("chat_api_failed",{moduleId:s,status:e.status,errText:r});const a=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(o),mode:"cors"}).catch(()=>null);if(!a||!a.ok)return{text:r};const n=await a.json().catch(async()=>({text:await a.text()})),u=typeof(n.reply??n.text)=="string"?n.reply??n.text:JSON.stringify(n),d=Array.isArray(n.attachments)?n.attachments:[];return{text:u,attachments:d}}const t=await e.json().catch(()=>null);if(!t)return null;const p=typeof(t.reply??t.text)=="string"?t.reply??t.text:JSON.stringify(t),y=Array.isArray(t.attachments)?t.attachments:[];return{text:p,attachments:y}}catch{return null}}export{x as sendChat};
