const f={invoice:"https://n8n.srv1009033.hstgr.cloud/webhook/process",ga:"https://n8n.srv1009033.hstgr.cloud/webhook/process",kdr:"https://n8n.srv1009033.hstgr.cloud/webhook/process"};async function x(a,o){const i="/api/send",l=f[a];try{const c=new AbortController,h=setTimeout(()=>c.abort(),15e3),n=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(o),signal:c.signal,mode:"cors"});if(clearTimeout(h),!n.ok){const r=await n.text().catch(()=>"Service unavailable");console.warn("chat_api_failed",{moduleId:a,status:n.status,errText:r});const s=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(o),mode:"cors"}).catch(()=>null);if(!s||!s.ok)return{text:r};const e=await s.json().catch(async()=>({text:await s.text()})),u=typeof(e.reply??e.text)=="string"?e.reply??e.text:JSON.stringify(e),d=Array.isArray(e.attachments)?e.attachments:[];return{text:u,attachments:d}}const t=await n.json().catch(()=>null);if(!t)return null;const p=typeof(t.reply??t.text)=="string"?t.reply??t.text:JSON.stringify(t),y=Array.isArray(t.attachments)?t.attachments:[];return{text:p,attachments:y}}catch{return null}}export{x as sendChat};
